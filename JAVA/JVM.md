# JVM

- 시스템 메모리를 관리하면서, 자바 기반 애플리케이션을 위해 이식 가능한 실행 환경을 제공함
- JVM 실행에 있어서 가장 일반적인 상호작용은, 힙과 스택의 메모리 사용을 확인하는 것

### 실행과정

1. 자바 프로그램을 실행하면 JVM은 OS로부터 메모리를 할당받는다.
2. 자바 컴파일러가 자바 소스코드를 자바 바이트 코드로 컴파일 한다.
3. Class Loader는 동적 로딩을 통해 필요한 클래스들을 로딩 및 링크하여 Runtime Data Area에 올린다.
4. Runtime Data Area에 로딩 된 바이트 코드는 Execution Engine을 통해 해석된다.
5. 이 과정에서 Execution Engine에 의해 Garbage Collector의 작동과 Thread 동기화가 이루어진다.

### 자바 컴파일러

- 자바 소스코드(.java)를 바이트 코드(.class)로 변환시켜줌

### 클래스 로더

- JVM은 런타임시에 처음으로 클래스를 참조할 때 해당 클래스를 로드하고 메모리 영역에 배치시킴. 이 동적 로드를 담당하는 부분이 바로 클래스 로더

### Runtime Data Areas

JVM이 운영체제 위에서 실행되면서 할당받는 메모리 영역

**PC 레지스터, JVM 스택, 네이티브 메서드 스택, 힙, 메서드 영역**

(이 중에 힙과 메서드 영역은 모든 스레드가 공유해서 사용함)

- **PC 레지스터** : PC레지스터는 쓰레드가 시작될 때 생셩되며, **현재 수행중인 JVM 명령어 주소를 저장**하는 공간이다. JVM 명령의 주소는 쓰레드가 어떤 부분을 무슨 명령으로 실행해야할 지에 대한 기록을 가지고 있다.

- **스택 Area** : 지역변수, 파라미터, 리턴값, 연산에 사용되는 임시값이 저장되는 영역.

- **네이티브 메서드 스택** : 네이티브 메소드가 호출될 경우 해당 스택 프레임을 만들어 해당 **네이티브 메소드에 대한 정보**를 저장합니다.

```
네이티브 메소드란?
네이티브 메소드는 자바가 아닌 다른 언어로 구현된 메소드입니다.
네이티브 메소드의 앞에는 native 키워드가 붙어있습니다.
```

- **힙** : 런타임에 동적으로 할당되는 데이터가 저장되는 영역. 객체나 배열 생성이 여기에 해당함(또한 힙에 할당된 데이터들은 가비지컬렉터의 대상이 됨. JVM 성능 이슈에서 가장 많이 언급되는 공간임)

- **메서드 영역** : 클래스 정보, 변수정보, 메소드정보, Constant pool 등을 분류해서 저장한다. JVM이 동작해서 클래스가 로딩될 때 생성된다.

![68747470733a2f2f692e696d6775722e636f6d2f5679314a4331622e706e67.png](img/jvm.png)